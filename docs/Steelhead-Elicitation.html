<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Steelhead-Elicitation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Steelhead-Elicitation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Steelhead-Elicitation_files/libs/quarto-html/quarto.js"></script>
<script src="Steelhead-Elicitation_files/libs/quarto-html/popper.min.js"></script>
<script src="Steelhead-Elicitation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Steelhead-Elicitation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Steelhead-Elicitation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Steelhead-Elicitation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Steelhead-Elicitation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Steelhead-Elicitation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Steelhead-Elicitation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Steelhead-Elicitation_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Steelhead-Elicitation_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Steelhead-Elicitation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="steelhead-elicitation-results-round-1" class="level1">
<h1>Steelhead Elicitation Results Round 1</h1>
<section id="regions" class="level2">
<h2 class="anchored" data-anchor-id="regions">Regions</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="stars_regions.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">STARS regions</figcaption>
</figure>
</div>
</section>
<section id="survival-covariates" class="level2">
<h2 class="anchored" data-anchor-id="survival-covariates">Survival Covariates</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Steelhead-Elicitation_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Survival Results</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Reached 100% consensus on Region 1 survival</li>
<li>Split for the remaining regions</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Covariates for Survival by Region</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">region</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">covariate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">prop</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">med_conf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">1</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">1.00</td>
<td style="text-align: right; border-bottom: 1px solid;">3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left; border-bottom: 1px solid;">2</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.38</td>
<td style="text-align: right; border-bottom: 1px solid;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">3</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.44</td>
<td style="text-align: right; border-bottom: 1px solid;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Vernalis Flow</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">2.0</td>
</tr>
</tbody>
</table>


</div>
</div>
<section id="rationale" class="level3">
<h3 class="anchored" data-anchor-id="rationale">Rationale</h3>
<section id="region-1" class="level4">
<h4 class="anchored" data-anchor-id="region-1">Region 1</h4>
<section id="vernalis-flow" class="level5">
<h5 class="anchored" data-anchor-id="vernalis-flow">Vernalis Flow</h5>
</section>
<section id="omr" class="level5">
<h5 class="anchored" data-anchor-id="omr">OMR</h5>
</section>
<section id="cvpswp-exports" class="level5">
<h5 class="anchored" data-anchor-id="cvpswp-exports">CVP/SWP Exports</h5>
</section>
</section>
<section id="region-2" class="level4">
<h4 class="anchored" data-anchor-id="region-2">Region 2</h4>
<section id="vernalis-flow-1" class="level5">
<h5 class="anchored" data-anchor-id="vernalis-flow-1">Vernalis Flow</h5>
</section>
<section id="omr-1" class="level5">
<h5 class="anchored" data-anchor-id="omr-1">OMR</h5>
</section>
<section id="cvpswp-exports-1" class="level5">
<h5 class="anchored" data-anchor-id="cvpswp-exports-1">CVP/SWP Exports</h5>
</section>
</section>
<section id="region-3" class="level4">
<h4 class="anchored" data-anchor-id="region-3">Region 3</h4>
<section id="vernalis-flow-2" class="level5">
<h5 class="anchored" data-anchor-id="vernalis-flow-2">Vernalis Flow</h5>
</section>
<section id="omr-2" class="level5">
<h5 class="anchored" data-anchor-id="omr-2">OMR</h5>
</section>
<section id="cvpswp-exports-2" class="level5">
<h5 class="anchored" data-anchor-id="cvpswp-exports-2">CVP/SWP Exports</h5>
</section>
</section>
<section id="region-4" class="level4">
<h4 class="anchored" data-anchor-id="region-4">Region 4</h4>
<section id="vernalis-flow-3" class="level5">
<h5 class="anchored" data-anchor-id="vernalis-flow-3">Vernalis Flow</h5>
</section>
<section id="omr-3" class="level5">
<h5 class="anchored" data-anchor-id="omr-3">OMR</h5>
</section>
<section id="cvpswp-exports-3" class="level5">
<h5 class="anchored" data-anchor-id="cvpswp-exports-3">CVP/SWP Exports</h5>
</section>
</section>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<ul>
<li><p>Perry et al.&nbsp;2018</p></li>
<li><p>Buchanan et al.&nbsp;2021</p></li>
<li><p>Pope et al.&nbsp;2025</p></li>
<li><p>Buchanan and Whitlock (2022): temperature was better supported than Delta inflow for FR Chinook; correlation between temperature and flow</p></li>
<li><p>Cavallo et al.&nbsp;2015</p></li>
<li><p>Buchanan, R.A., Skalski, J.R. Relating survival of fall-run Chinook Salmon through the San Joaquin Delta to river flow.</p></li>
<li><p>Hydrodynamics minimally affected by exports and OMR (Cavallo et al.&nbsp;2013, Cavallo, B., P. Gaskill and J. Melgo 2013, Cramer report</p></li>
<li><p>USFWS reports 2021, 2022, 2024; 2025)</p></li>
<li><p>South Delta steelhead survival studies (Matthias et al.) - 2011</p></li>
<li><p>Buchanan 2024</p></li>
<li><p>2024 CAMT Salmon Technical Working Group Final Report “a Review of Recent Science to Improve Our Understanding and Application of Life Cycle and Decision Support Models to Salmon Management in the South Delta”; Buchanan steelhead routing presentation June 2025; Buchanan et al.&nbsp;2021; Pope et al.&nbsp;2025; Buchanan and Whitlock 2022 Reclamation LTO FEIS Appendix I Old and Middle River Flow Management Attachment I.3 Delta Export Zone of Influence Analysis</p></li>
</ul>
</section>
</section>
<section id="routing-covariates" class="level2">
<h2 class="anchored" data-anchor-id="routing-covariates">Routing Covariates</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Steelhead-Elicitation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Routing Results</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Reached consensus on Region 1 routing</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Covariates for Routing by Region</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">region</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">covariate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">prop</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">med_conf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">1</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.94</td>
<td style="text-align: right; border-bottom: 1px solid;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left; border-bottom: 1px solid;">2</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.19</td>
<td style="text-align: right; border-bottom: 1px solid;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">3</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.38</td>
<td style="text-align: right; border-bottom: 1px solid;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Vernalis Flow</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="travel-time-covariates" class="level2">
<h2 class="anchored" data-anchor-id="travel-time-covariates">Travel Time Covariates</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Steelhead-Elicitation_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Travel Time Results</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>Reached consensus on Region 1 and Region 4 travel time</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table lightable-classic table-sm table-striped small" data-quarto-postprocess="true">
<caption>Covariates for Travel Time by Region</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">region</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">covariate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">prop</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">med_conf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">1</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">1.00</td>
<td style="text-align: right; border-bottom: 1px solid;">3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left; border-bottom: 1px solid;">2</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.06</td>
<td style="text-align: right; border-bottom: 1px solid;">3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 1px solid;">3</td>
<td style="text-align: left; border-bottom: 1px solid;">Vernalis Flow</td>
<td style="text-align: right; border-bottom: 1px solid;">0.50</td>
<td style="text-align: right; border-bottom: 1px solid;">1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">CVP + SWP Exports</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">OMR</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Vernalis Flow</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li>A Shiny app is available that would allow others in the group to see how exports, SJR inflows and OMR flows influence hydrodynamic conditions in each of these regions. Many participants may not be familiar with these data.</li>
</ul>
</section>
<section id="topics-to-be-discussed" class="level2">
<h2 class="anchored" data-anchor-id="topics-to-be-discussed">Topics to be discussed</h2>
<ul>
<li>On what basis should we determine “primary covariate”?</li>
<li><ol type="1">
<li>(Question about Pope et al 2025) NMFS would welcome some discussion about Region 2 and Region 4. Region 2 appears to overlap Region 4 from the export facilities north to HWY 4 – do survivals and travel times between those receivers contribute to relationships in both regions? Is there an assumed direction for transiting Region 4? Is it correct that fish that enter the mainstem San Joaquin River through the mouths of Middle or Old River (NOT via Turner Cut) do not contribute to transit success of Region 4?</li>
</ol></li>
<li><ol start="2" type="1">
<li>Comment: There is no current commitment or regulatory requirement for any barrier (rock or non-physical) at Head of Old River (HOR). So, NMFS assessed the explanatory value of the various covariates within the “barrier out” panels of figures. However, NMFS wonders if this ends up ignoring (a) much of the AT data which may have been conducted with the barrier in, and (b) much of the “more usual” Vernalis flows, i.e.&nbsp;&lt;5,000 cfs which, under past regulatory regimes, would be associated with “barrier in”. What did other experts think about barrier status?</li>
</ol></li>
</ul>
</section>
<section id="caveatssuggestions" class="level2">
<h2 class="anchored" data-anchor-id="caveatssuggestions">Caveats/Suggestions</h2>
<ul>
<li>Likely more options need to be considered or within variable wet/normal/dry scenarios</li>
<li>Tidal flow should be considered as the primary covariate for region 3.</li>
<li>Might it be reasonable to make competing predictions using competing covariates in some reaches, if the model set was restrained to just a couple of alternatives? The user would then select which model to use (e.g., OMR-driven dynamics in Region 4 vs export-driven dynamics in Region 4).</li>
<li>Covariates should be ranked primarily on their mechanistic basis and the strength of that physical effect in the region of interest. For example, if the expected effect of exports is altered hydrodynamics, exports should not be considered as a covariate in regions where exports do appreciably change hydrodynamic conditions experienced and perceived by fish. Should be an option to have none of these three environmental covariates in regions where none of a clear, strong mechanistic effect.</li>
<li>All responses are within the context of “modern” operations post-2009 under the conditions observed in literature cited. I am uncertain of what the primary covariate would be if operations were significantly changed during juvenile salmonid outmigration period. There are many factors, if significantly modified may impact survival and routing– installation of barriers, habitat restoration improvements to facilities, significant increases or decreases of pumping rates, predator control measures, changes to trucking and release operations. For example, if water exports were always at maximum capacity or significantly more negative than -5,000 OMR Index, exports and OMR more likely to influence routing than under modern conditions. Exports and OMR could become increasingly more of important covariate on survival in those regions that are close in proximity to export facilities. I’m uncertain if it would be more of negative impact on survival or positive impact on survival. Under poor conditions, perhaps it would increase survival by through the salvage operations, fish would get a free ride to a better environment like we have seen in some chinook salmon studies. However, the salvage operations are most efficient at a specific rate–not too fast and not too slow.</li>
<li>Probably more relevant for chinook: My hypothesis that the salvage operations route probably increases survival of fry-size chinook during wet years. We observe a lot of fry-size chinook in salvage during wet years. Most of salmonid observations for these routing and survival studies are based on smolt-sized fish that are large enough to be acoustically tagged.</li>
</ul>
</section>
<section id="concerns" class="level2">
<h2 class="anchored" data-anchor-id="concerns">Concerns</h2>
<ul>
<li>I am concerned that the published paper is confining the expert elicitation. It seems that experts should be consulted prior to modeling to establish the proposed hypotheses and mechanisms. Both the model structure and predictor variables could be quite different with such an exercise. I think response variables may also be reduced. For example, would we mange for reduced travel time if it doesn’t help survival? What about routing?</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>